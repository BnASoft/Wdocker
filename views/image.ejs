<!DOCTYPE html>
<html lang="ko">

<head>
  <% include ./partials/head %>
  <!-- 스크립트 -->
  <script src='/myapp/js/socketio.js'></script>
  <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
</head>

<body>
  <% include ./partials/topnav %>

<div class="container-fluid">
      <div class="row">
        <% include ./partials/nav %>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <div class="col-md-6" >
            <h3>Search Images</h3>
              <form class="form-horizontal" id="SearchImages">
                  <div class="form-group">
                    <label for="term" class="col-sm-2 control-label">Term: </label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="term" placeholder="Term">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="limit" class="col-sm-2 control-label">limit: </label>
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="limit"  placeholder="limit">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="filters" class="col-sm-2 control-label">filters: </label>
                    <div class="col-sm-10">
                      <label class="checkbox-inline">
                        is_automated <input type="checkbox" id="is_automated" checked data-toggle="toggle" data-on="true"
                         data-off="false" data-onstyle="success" data-offstyle="danger">
                      </label>
                      <label class="checkbox-inline">
                        is_official <input type="checkbox" id="is_official" checked data-toggle="toggle" data-on="true"
                         data-off="false" data-onstyle="success" data-offstyle="danger">
                      </label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" id="stars"  placeholder="stars">
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="btn btn-primary">Search</button>
              </form>
          </div>
          <div class="col-md-6" >
              <h3>Search Results</h3>
              <ul id="results">
              </ul>
          </div>
          <div class="row placeholders">
            <script>
            var socket = io();
                var data =<%-JSON.stringify(data)%>
                console.log(data);
                console.log(data.length);

                $(function(){
                  $("#SearchImages").submit(function(e) {
                    e.preventDefault();
                    var $term=$("#term");
                    var $limit =$('#limit');
                    var $is_automated = $('#is_automated');
                    var $is_official = $('#is_official');
                    var $stars = $("#stars");

                    var _term = $term.val();
                    var _limit = $limit.val();
                    var _is_automated = $is_automated.prop('checked').toString();
                    var _is_official = $is_official.prop('checked').toString();
                    var _stars = $stars.val();
                    if( !_stars ){
                      _stars = "0";
                    }
                    var opts = {
                      term : _term,
                      limit : _limit,
                      filters : {}
                    }
                    opts["filters"] = {
                      "is-automated" : [_is_automated],
                      "is-official": [_is_official],
                      "stars" : [_stars]
                    };
                    console.log(opts);

                    socket.emit("searchImages", opts);

                    socket.on("searchResult", function(data){
                      var results = JSON.stringify(data);
                      $('#results li').remove();
                      if(!results) {
                          $('#results').append("<li>not Found</li>");
                      }
                      $('#results').append("<li>"+results+"</li>");
                    });
                  });

                });




            </script>

        <table class="table table-striped">
          <thead>
            <tr>
              <td>#</td>
              <td>Containers</td>
              <td>Created</td>
              <td>Id</td>
              <td>Labels</td>
              <td>ParentId</td>
              <td>RepoDigests</td>
              <td>RepoTags</td>
              <td>SharedSize</td>
              <td>Size</td>
              <td>VirtualSize</td>
            </tr>
          </thead>
          <% for(var i=0; i < data.length; i++) { %>
           <tr>
             <td><%- i %></td>
             <td><%- data[i].Containers %></td>
             <td><%- data[i].Created %></td>
             <td><%- data[i].Id %></td>
             <td><%- data[i].Labels %></td>
             <td><%- data[i].ParentId %></td>
             <td><%- data[i].RepoDigests %></td>
             <td><%- data[i].RepoTags %></td>
             <td><%- data[i].SharedSize %></td>
             <td><%- data[i].Size %></td>
             <td><%- data[i].VirtualSize %></td>
           </tr>
           <% } %>
        </table>
          </div>

        </div>
        </div>
</div>

</body>
</html>
